<!--넘어오는 data : foodImgList, foodVideoList / activityImgList, activityVideoList-->
<!--이미지와 비디오 조건 어떻게 나누지
조건에 따라 <img> 추가하거나 <video> 추가하면 될듯-->
<!DOCTYPE html>
<html>
    <head>
        <link rel='stylesheet' href='/css/main.css' /> 
        <script
        src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
        crossorigin="anonymous"></script>
        <script src="https://momentjs.com/downloads/moment-with-locales.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
        <script>
            function Timer(ad_ID, user_ID) { 
                console.log("======Timer 함수 내=======");
                console.log(ad_ID, user_ID);
                setTimeout(callAPI, 15000, ad_ID, user_ID); //15초 후에 db에 저장하면서 rating화면으로 전환.
            } 
            function callAPI(ad_ID, user_ID) {
                console.log("======callAPI함수 내=======");
                console.log(ad_ID);
                console.log(user_ID);
                console.log("call success");
                $.ajax({
                    url: '/adDB',
                    dataType: 'json',
                    type: 'POST',
                    data: {
                        'ad_id': ad_ID,
                        'user_id': user_ID
                    },
                    success: function(response) {
                        console.log('adDB 통신 success');
                        console.log(response.userID);
                        // res.render('rating', {
                        //     user_id:response.user_id
                        // })
                        console.log("'rating' 렌더링 성공");
                    }
                });
                // location.replace("/rating");
            }
            // //화면 전환
            // function Timer() { 
            //     setTimeout("locateKap()",25000); 
            // } 

          
            //     } else {
            //         // 시간이 남았을 경우 카운트다운을 지속한다.
            //         document.all.count_text.innerHTML = cnt + "초후에 힐링 화면으로 이동합니다..";
            //         setTimeout("countdown()",1000);
            //         cnt--;
            //     }
            // } 
        </script>
    </head> 
    <body>
        <h3 style='display:none;'><%= userID %></h3>
        <h2 style='display:none;'><%= adData.id %></h2>
        <script>
            // const bgSrcTag = document.querySelector('.bg img[src]').getAttribute('src');
            const ad_ID = document.querySelector('h2').innerText;
            const user_ID = document.querySelector('h3').innerText;
            // console.log(bgTag);
            // console.log(ad_ID);
            // console.log(user_ID);
            // callAPI(bgTag, ad_ID);
            Timer(ad_ID, user_ID);
        </script>

        <div id="bg">
            <% adSrc = adData.src %>
            <!-- <% if (adSrc.indexOf('.jpg') != -1 || adSrc.indexOf('.jpeg') != -1 || adSrc.indexOf('.JPG') !=) { %> -->
            <% if (adSrc.toLowerCase().indexOf('.jpg') != -1 || adSrc.indexOf('.jpeg') != -1) { %>
                <img src="<%= adData.src %>"/>
            <% } else if (adSrc.indexOf('.mp4') != -1) { %>
                <video muted autoplay loop>
                    <source src="<%= adData.src %>" type="video/mp4">
                </video>
            <% } %>
        </div>
    </body>
</html>